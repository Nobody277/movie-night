<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MKV Playback Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #1a1a1a; 
            color: #e0e0e0; 
            font-family: monospace; 
            padding: 20px;
        }
        video { 
            width: 100%; 
            max-width: 800px; 
            background: #000; 
            display: block;
            margin: 20px auto;
        }
        #logs { 
            max-width: 800px; 
            margin: 20px auto; 
            background: #0a0a0a; 
            padding: 15px; 
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        .log { 
            padding: 4px 0; 
            border-bottom: 1px solid #2a2a2a;
        }
        .log:last-child { border-bottom: none; }
        .time { color: #666; margin-right: 10px; }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .info { color: #4dabf7; }
        h1 { text-align: center; margin-bottom: 10px; font-size: 18px; }
        .url { 
            max-width: 800px; 
            margin: 0 auto 10px; 
            padding: 10px; 
            background: #0a0a0a; 
            border-radius: 4px;
            word-break: break-all;
            font-size: 11px;
            color: #888;
        }
    </style>
</head>
<body>
    <h1>MKV Direct Playback Test</h1>
    <div class="url" id="videoUrl"></div>
    <video id="player" controls></video>
    <div id="logs"></div>

    <script>
        const VIDEO_URL = 'https://a.111477.xyz/movies/Fight%20Club%20(1999)/Fight.Club.1999.UHD.Re-Grade.6000nit.2160p.HEVC.HDR.IVA(RUS.UKR.ENG).ExKinoRay.mkv';
        const player = document.getElementById('player');
        const logsDiv = document.getElementById('logs');
        
        document.getElementById('videoUrl').textContent = VIDEO_URL;

        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log ${type}`;
            logEntry.innerHTML = `<span class="time">[${time}]</span>${message}`;
            logsDiv.insertBefore(logEntry, logsDiv.firstChild);
        }

        // Test 1: Direct MKV playback
        log('Starting direct MKV playback test...', 'info');
        player.src = VIDEO_URL;

        // Event listeners
        player.addEventListener('loadstart', () => {
            log('loadstart: Browser started loading video', 'info');
        });

        player.addEventListener('loadedmetadata', () => {
            log(`loadedmetadata: Duration = ${player.duration.toFixed(2)}s, VideoWidth = ${player.videoWidth}, VideoHeight = ${player.videoHeight}`, 'success');
        });

        player.addEventListener('loadeddata', () => {
            log('loadeddata: First frame loaded', 'success');
        });

        player.addEventListener('canplay', () => {
            log('canplay: Video can start playing', 'success');
        });

        player.addEventListener('canplaythrough', () => {
            log('canplaythrough: Video can play without buffering', 'success');
        });

        player.addEventListener('playing', () => {
            log('playing: Video is now playing', 'success');
        });

        player.addEventListener('waiting', () => {
            log('waiting: Video is buffering...', 'info');
        });

        player.addEventListener('seeking', () => {
            log(`seeking: User seeking to ${player.currentTime.toFixed(2)}s`, 'info');
        });

        player.addEventListener('seeked', () => {
            log(`seeked: Seek completed at ${player.currentTime.toFixed(2)}s`, 'success');
        });

        player.addEventListener('error', (e) => {
            const error = player.error;
            let errorMsg = 'Unknown error';
            if (error) {
                switch(error.code) {
                    case 1: errorMsg = 'MEDIA_ERR_ABORTED: Playback aborted'; break;
                    case 2: errorMsg = 'MEDIA_ERR_NETWORK: Network error'; break;
                    case 3: errorMsg = 'MEDIA_ERR_DECODE: Decoding error (codec not supported)'; break;
                    case 4: errorMsg = 'MEDIA_ERR_SRC_NOT_SUPPORTED: Format not supported'; break;
                }
                errorMsg += ` - ${error.message || ''}`;
            }
            log(`ERROR: ${errorMsg}`, 'error');
            log('MKV format is not supported by Chrome. Need transcoding solution.', 'error');
        });

        player.addEventListener('stalled', () => {
            log('stalled: Download has stalled', 'error');
        });

        player.addEventListener('suspend', () => {
            log('suspend: Download suspended', 'info');
        });

        player.addEventListener('progress', () => {
            if (player.buffered.length > 0) {
                const buffered = player.buffered.end(player.buffered.length - 1);
                log(`progress: Buffered ${buffered.toFixed(2)}s`, 'info');
            }
        });

        // Log initial attempt
        log(`Attempting to load: ${VIDEO_URL}`, 'info');
        log('Expected result: Chrome will fail to play MKV (codec not supported)', 'info');
    </script>
</body>
</html>